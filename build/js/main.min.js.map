{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.min.js","sourcesContent":["\n//init\nvar left = document.getElementById('left'),\n    right = document.getElementById('right'),\n    links = document.getElementById('links'),\n    mufta = document.getElementById('mufta'),\n    data = {},\n    sizes = {\n    \twidth: mufta.getBoundingClientRect().width,\n    \theight: mufta.getBoundingClientRect().height,\n    \tcableWidth: mufta.getBoundingClientRect().width / 5,\n    \tcableHeight: 20,\n    \tlineHeight: 2,\n    \tconnectorRadius: 3,\n    \tshiftXTimes: 4\n    },\n    tmp = {},\n    shiftYGlobal = {left: [], right: []},\n    textareas = document.getElementsByTagName('textarea');\n\n\t//events\n\tfor (var n = 0; textareas[n]; n++)\n\t\ttextareas[n].addEventListener('keyup', update, false);\n\n\nfunction update() {\n\tshiftYGlobal = {left: [], right: []};\n\t_createDataArray('left'),\n\t_createDataArray('right'),\n\tdata.links = links.value.split('\\n');\n\n\twhile (mufta.lastChild) {\n\t\tmufta.removeChild(mufta.lastChild);\n\t}\n\tmufta.setAttribute('height',\n\t\tMath.max(data.left.length + shiftYGlobal.left.length, data.right.length + shiftYGlobal.right.length) * sizes.cableHeight + 1);\n\trenderCables();\n\trenderLinks();\n}\n\n\nfunction renderLinks() {\n\tvar x2, y2, x1, y1, center, color,\n\t\tmatrixX = Array(Math.max(data.left.length, data.right.length)).fill(0),\n\t\t_shiftsXMap = {center: [], left: [], right: []},\n\t\tshiftsXMap,\n\t\tstart,\n\t\tend;\n\t\n\n\tfor (var n = 0; n < data.links.length; n++) {\n\t\tdata.links[n] = data.links[n].trim();\n\t\tif (data.links[n] == \"\")\n\t\t\tcontinue;\n\n\n\t\tif (data.links[n].substr(0,1) == \"_\") {\n\t\t\tend = start = 'right';\n\t\t\tx1 = x2 = sizes.width - sizes.cableWidth;\n\t\t\tcenter = x2 - sizes.cableWidth / 2;\n\t\t\tshiftsXMap = _shiftsXMap.right;\n\n\t\t} else if (data.links[n].substr(-1) == \"_\") {\n\t\t\tend = start = 'left';\n\t\t\tx1 = x2 = sizes.cableWidth;\n\t\t\tcenter = sizes.cableWidth * 1.5;\n\t\t\tshiftsXMap = _shiftsXMap.left;\n\n\t\t} else {\n\t\t\tstart = 'left';\n\t\t\tend = 'right';\n\t\t\tx1 = sizes.cableWidth;\n\t\t\tx2 = sizes.width - sizes.cableWidth;\n\t\t\tcenter = (x2 - x1) / 2 + x1;\n\t\t\tshiftsXMap = _shiftsXMap.center;\n\t\t}\n\n\t\tvar dn = data.links[n].replace('_','').split('-'),\n\t\t\tstartPos = +dn[0],\n\t\t\tendPos = +dn[1],\n\t\t\tstartData = data[start][startPos],\n\t\t\tendData = data[end][endPos];\n\n\t\tif (startData && endData) {\n\t\t\tstartColor = startData.slice(-1)[0];\n\t\t\tendColor = endData.slice(-1)[0];\n\n\t\t\ty1 = startPos * sizes.cableHeight + sizes.cableHeight / 2;\n\t\t\ty2 = endPos * sizes.cableHeight + sizes.cableHeight / 2;\n\n\t\t\ty1 = _updateY(y1, start == 'left' ? 0 : Infinity);\n\t\t\ty2 = _updateY(y2, end == 'right' ? Infinity : 0);\n\n\t\t\tshiftX = 0;\n\t\t\tif (startPos != endPos) {\n\t\t\t\tshiftX = startPos < endPos ? 1 : -1;\n\t\t\t\twhile (shiftsXMap.indexOf(shiftX) >=0)\n\t\t\t\t\tshiftX += shiftX > 0 ? 1 : -1;\n\t\t\t\tshiftsXMap.push(shiftX);\n\t\t\t\tshiftX *= sizes.lineHeight * sizes.shiftXTimes;\n\n\t\t\t\t//vertical shift\n\t\t\t\tif (shiftX > 0) {\n\t\t\t\t\ty1 += sizes.lineHeight;\n\t\t\t\t\ty2 += sizes.lineHeight;\n\t\t\t\t} else {\n\t\t\t\t\ty1 -= sizes.lineHeight;\n\t\t\t\t\ty2 -= sizes.lineHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_addLine(x1, y1, center + shiftX, y1, startColor);\n\t\t\t_addLine(center + shiftX, y1, center + shiftX, y2, startColor);\n\t\t\t_addLine(center + shiftX, y2, x2, y2, endColor);\n\t\t\tif (startColor != endColor) {\n\t\t\t\t_addSoldering(center + shiftX, y2, startColor, endColor);\n\t\t\t}\n\t\t}\n\n\n\t}\n\tlinks.value = data.links.join('\\n');\n}\n\n\nfunction renderCables() {\n\tvar node,\n\t    color,\n\t    prev = [],\n\t    dn,\n\t    y, x, width, height,\n\t    cable = 0;\n\n\tfor (var n = 0; data.left[n]; n++) {\n\t\tdn = data.left[n];\n\t\tcolor = dn[dn.length -1];\n\t\tnode = _addConnector(color, n, 'left');\n\n\t\tfor (var l = 0; l < dn.length - 1; l++) {\n\t\t\tif (!prev[l])\n\t\t\t\tprev[l] = {data: dn[l], n: n};\n\t\t\telse if (prev[l].data != dn[l]) {\n\t\t\t\ty = prev[l].n * sizes.cableHeight;\n\t\t\t\twidth = sizes.cableWidth / dn.length;\n\t\t\t\tx = width * l;\n\t\t\t\theight = (n - prev[l].n) * sizes.cableHeight;\n\t\t\t\tnode = _addRect(y, x, width, height, \"#fff\");\n\t\t\t\t_addText(prev[l].data, y + height/2, x + width/2, \"-90\");\n\t\t\t\tprev[l] = {data: dn[l], n: n};\n\t\t\t}\n\t\t}\n\t}\n\tfor (var l = 0; l < dn.length - 1; l++) {\n\t\ty = prev[l].n * sizes.cableHeight;\n\t\twidth = sizes.cableWidth / dn.length;\n\t\tx = width * l;\n\t\theight = (n - prev[l].n) * sizes.cableHeight;\n\t\tnode = _addRect(y, x, width, height, \"#fff\");\n\t\t_addText(prev[l].data, y + height/2, x + width/2, \"-90\");\n\t}\n\tprev = [];\n\n\tfor (var n = 0; data.right[n]; n++) {\n\t\tdn = data.right[n];\n\t\tcolor = dn[dn.length -1];\n\t\tnode = _addConnector(color, n, 'right');\n\n\t\tfor (var l = 0; l < dn.length - 1; l++) {\n\t\t\tif (!prev[l])\n\t\t\t\tprev[l] = {data: dn[l], n: n};\n\t\t\telse if (prev[l].data != dn[l]) {\n\t\t\t\ty = prev[l].n * sizes.cableHeight;\n\t\t\t\twidth = sizes.cableWidth / dn.length;\n\t\t\t\tx = sizes.width - width * (l + 1);\n\t\t\t\theight = (n - prev[l].n) * sizes.cableHeight;\n\t\t\t\tnode = _addRect(y, x, width, height, \"#fff\");\n\t\t\t\t_addText(prev[l].data, y + height/2, x + width/2, \"90\");\n\t\t\t\tprev[l] = {data: dn[l], n: n};\n\t\t\t}\n\t\t}\n\t}\n\tfor (var l = 0; l < dn.length - 1; l++) {\n\t\ty = prev[l].n * sizes.cableHeight;\n\t\twidth = sizes.cableWidth / dn.length;\n\t\tx = sizes.width - width * (l + 1);\n\t\theight = (n - prev[l].n) * sizes.cableHeight;\n\t\tnode = _addRect(y, x, width, height, \"#fff\");\n\t\t_addText(prev[l].data, y + height/2, x + width/2, \"90\");\n\t}\n}\n\n\nfunction _addConnector(color, n, pos) {\n\tvar y = n * sizes.cableHeight,\n\t    x = pos == 'left' ? 0 : sizes.width - sizes.cableWidth,\n\t    height = sizes.cableHeight,\n\t    width = sizes.cableWidth;\n\n\t_addRect(y, x, width, height, color);\n}\n\nfunction _addRect(y, x, width, height, color) {\n\tvar node = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\ty = _updateY(y, x);\n\tnode.setAttribute('y', y);\n\tnode.setAttribute('x', x);\n\tnode.setAttribute('height', height);\n\tnode.setAttribute('width', width);\n\tnode.setAttribute('style', \"fill:\" + color + \"; stroke-width:1; stroke:#111\");\n\tmufta.appendChild(node);\n\treturn node;\n}\nfunction _addLine(x1, y1, x2, y2, color) {\n\tvar node = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\tnode.setAttribute('y1', y1);\n\tnode.setAttribute('x1', x1);\n\tnode.setAttribute('y2', y2);\n\tnode.setAttribute('x2', x2);\n\tnode.setAttribute('style', \"stroke:\" + color + \"; stroke-width:\" + sizes.lineHeight); //; shape-rendering:crispEdges;\n\tmufta.appendChild(node);\n\treturn node;\n}\nfunction _addSoldering(cx, cy, colorFill, colorBorder) {\n\tvar node = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n\tnode.setAttribute('cy', cy);\n\tnode.setAttribute('cx', cx);\n\tnode.setAttribute('r', sizes.connectorRadius);\n\tnode.setAttribute('fill', colorFill);\n\tnode.setAttribute('style', \"stroke:\" + colorBorder + \"; stroke-width:1\"); //; shape-rendering:crispEdges;\n\tmufta.appendChild(node);\n\treturn node;\n}\nfunction _addText(text, y, x, rotate) {\n\tvar newText = document.createElementNS('http://www.w3.org/2000/svg',\"text\");\n\ty = _updateY(y, x);\n\tnewText.setAttribute(\"y\",y);\n\tnewText.setAttribute(\"x\",x);\n\tif (rotate)\n\t\tnewText.setAttribute(\"transform\",\"rotate(\" + rotate + \", \" + x + \", \" + y + \")\");\n\tnewText.setAttribute(\"font-family\",\"sans-serif\");\n\tnewText.setAttribute(\"font-size\",\"10px\");\n\tnewText.setAttribute(\"text-anchor\",\"middle\");\n\tnewText.setAttribute(\"dominant-baseline\",\"middle\");\n\tnewText.setAttribute(\"fill\",\"red\");\n\tnewText.appendChild(document.createTextNode(text));\n\tmufta.appendChild(newText);\n\treturn newText;\n}\n\n\nfunction _createDataArray(name) {\n\n\tif (!window[name] && !window[name].value) return;\n\n\tvar rows0 = window[name].value.split('\\n'),//.sort();\n\t\tcable,\n\t\trow;\n\t\n\tdata[name] = [];\n\n\tfor (var n = 0; rows0[n]; n++) {\n\t\trows0[n] = rows0[n].trim();\n\t\tif (rows0[n] > \"\") {\n\t\t\trow = rows0[n].split(',');\n\t\t\tdata[name].push(row);\n\t\t\tif (row[0] != cable) {\n\t\t\t\tcable = row[0];\n\t\t\t\tshiftYGlobal[name].push(sizes.cableHeight * n);\n\t\t\t}\n\t\t}\n\t}\n\twindow[name].value = rows0.join('\\n');\n\n}\n\n\nfunction _updateY(y, x) {\n\tvar name = x < sizes.width / 2 ? 'left' : 'right';\n\tfor(var n = shiftYGlobal[name].length; n >= 0; n--) {\n\t\tif (shiftYGlobal[name][n] <= y) {\n\t\t\ty += Math.max(n, 0) * 20;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn y + 1;\n}"]}